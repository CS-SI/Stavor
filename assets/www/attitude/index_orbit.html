
<!doctype html>
<html lang="en">
<head>
	<title>Sphere</title>
	<meta charset="utf-8">
	<!--<meta name="viewport" content="width=device-width">--><!-- target-densitydpi=device-dpi -->
	<meta name="viewport" content="width=device-width, height=device-height, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<link rel=stylesheet href="css/base.css"/>
</head>
<body>

<script type='text/javascript' src="js/three.js"></script>
<script type='text/javascript' src="js/three.ext.js"></script>
<script type='text/javascript' src="interface_orbit.js"></script>
<script type='text/javascript' src="init_orbit.js"></script>
<script type='text/javascript' src="update_orbit.js"></script>
<script type='text/javascript' src="modules/scene_orbit.js"></script>
<script type='text/javascript' src="modules/reference.js"></script>
<script type='text/javascript' src="modules/spacecraft.js"></script>
<script type='text/javascript' src="modules/angles.js"></script>
<script type='text/javascript' src="modules/sun.js"></script>
<script type='text/javascript' src="modules/earth.js"></script>
<script type='text/javascript' src="modules/indicators.js"></script>
<script type='text/javascript' src="modules/view.js"></script>
<script type='text/javascript' src="js/mySprites_orbit.js"></script>

<script type='text/javascript' src="js/Detector.js"></script>
<script type='text/javascript' src="js/Stats.js"></script>
<!--<script src="js/OrbitControls.js"></script>-->
<script type='text/javascript' src="js/TrackballControls.js"></script>
<!--<script src="js/THREEx.KeyboardState.js"></script>
<script src="js/THREEx.FullScreen.js"></script>
<script src="js/THREEx.WindowResize.js"></script>-->

<script type='text/javascript' src='js/DAT.GUI.min.js'></script>

<script src='extensions/threex.planets.js'></script>
<script src='extensions/threex.atmospherematerial.js'></script>
<script src="extensions/threex.atmospheredatgui.js"></script>

<script type='text/javascript' src="js/shaders/ShaderEngine.js"></script><!-- SC engine plasma -->
<script type='text/javascript' src="js/shaders/ShaderGlow.js"></script><!-- Sun glow effect -->
<script type='text/javascript' src="js/shaders/ShaderSun.js"></script><!-- Sun surface -->

<div id="ThreeJS" style="position: absolute; left:0px; top:0px; background-color:black"></div>
<script>
	// MAIN
	//***********************************************************************************************************************
	//		GLOBAL VARIABLES
	//***********************************************************************************************************************
	setLoadingProgress(5);
	var container, scene, camera, renderer, controls, stats, light, delta;
	var sun, sunGlow, sunLight, lineSun, spriteSun, contextSun;
	var earth, contextEarth, lineEarth, spriteEarth;
	var plane_orb, incl_arc, spriteInclination, contextInclination;
	//var keyboard = new THREEx.KeyboardState();
	var clock = new THREE.Clock();
	var spacecraft, arrow_vel, arrow_accel, arrow_momentum, target_a, vector_a, direction_a;
	var long_arc, lat_arc, long_sprite, lat_sprite, lineAngle, lineSpheric, lineSpheric2;
	var vectors_arc, vectors_sprite;
	var origin = new THREE.Vector3(0,0,0);

	var fontsizeSun, borderColorSun, borderThicknessSun, backgroundColorSun, fontColorSun;
	var fontsizeEarth, borderColorEarth, borderThicknessEarth, backgroundColorEarth, fontColorEarth;
	var fontsizeInclination, borderColorInclination, borderThicknessInclination, backgroundColorInclination, fontColorInclination;
	var fontsizeLongitude, borderColorLongitude, borderThicknessLongitude, backgroundColorLongitude, fontColorLongitude;
	var fontsizeLatitude, borderColorLatitude, borderThicknessLatitude, backgroundColorLatitude, fontColorLatitude;
	var fontsizeAngles, borderColorAngles, borderThicknessAngles, backgroundColorAngles, fontColorAngles;

	var fps_update_counter = 0;
	var miniSphereX,miniSphereXX,miniSphereY,miniSphereYY,miniSphereZ,miniSphereZZ;
	var gui, parameters;
	var axis_x = new THREE.Vector3(1,0,0);
	var axis_z = new THREE.Vector3(0,0,1);
	//-----------------------------------------------------------------------------------------------------------------------
	//			SCENE PARAMS (Hard-coded parameters)
	//-----------------------------------------------------------------------------------------------------------------------
	var canvas_mode = false;
	var cam_init_pos  = new THREE.Vector3(2,2,2);
	var cam_view_angle = 25;
	var cam_rend_near = 0.1;
	var cam_rend_far = 20000;

	var accel_time = 10;

	var earth_radius = 0.5;
	var axis_radius = earth_radius*1.35;
	var axis_earth_radius = earth_radius*1.15;
	
//-----------------------------------------------------------------------------------------------------------------------
//			PERFORMANCE VALUES (Set at initialization)
//-----------------------------------------------------------------------------------------------------------------------
	
	var show_fps = true;//Show FPS stats in Android
	var fps_update_skips = 60;

	var show_sky = true;

	var show_axis = true;
	var show_axis_labels = true;

	var show_earth_axis = true;
	
	var performance_level = 3;//1: VeryLow, 2: Low, 3: Normal, 4: High, 5: VeryHigh, 6: Ultra ...;
	
	//getInitialization();//If used in Android, update the init params with the Android configuration
	
	// Segments
	if(performance_level<1)
		performance_level=1;
	var segments_scale = performance_level;//Multiply segments of all geometries: 
//-----------------------------------------------------------------------------------------------------------------------
//			DYNAMIC VALUES (Updated at each cycle)
//-----------------------------------------------------------------------------------------------------------------------
	
	var value_attitude  = new THREE.Quaternion(0,0,0,1);
	var value_sun  = new THREE.Vector3(-1.1414775124432093E7,-1.464188429948789E8,7716114.240559303); //Km
	var value_earth  = new THREE.Vector3(7.337791634217176E-12,42164.0,-2.010800849831316E-12); //Km
	var value_velocity  = new THREE.Vector3(2.83195518282009,-5.49945264687097E-16,-1.1973314470667253); //Km/s
	var value_acceleration  = new THREE.Vector3(-4.517719883627554E-4,0.22420886513859567,1.9100613309698625E-4); //Km/s2
	var value_momentum  = new THREE.Vector3(5.048428313412141E10,-3.091270787372526E-6,1.1940655832842628E11); // direction --> will be normalized
	
//-----------------------------------------------------------------------------------------------------------------------

	init();

	var onRenderFcts= [];

	if(show_sky){
		var starSphere	= THREEx.Planets.createStarfield()
		scene.add(starSphere)
	}

	//-----------------------------------------------------------------------------------------------------------------------
	//			REFERENCE AXIS
	//-----------------------------------------------------------------------------------------------------------------------
	if(show_axis){
		var axis = new THREE.AxisHelper( axis_radius );
		axis.position.set( 0, 0, 0 );
		scene.add( axis );
	}
	if(show_axis_labels){
		var sprite_X = makeTextSprite( 0, " X ", 
		{ fontsize: 128, borderColor: {r:0, g:0, b:0, a:1.0}, borderThickness: 1, backgroundColor: {r:0, g:0, b:0, a:0.5}, fontColor: {r:255, g:174, b:0, a:1.0} } );
		sprite_X.position.set( axis_radius, 0, 0 );
		scene.add( sprite_X );
		
		var sprite_Y = makeTextSprite( 0, " Y ", 
		{ fontsize: 128, borderColor: {r:0, g:0, b:0, a:1.0}, borderThickness: 1, backgroundColor: {r:0, g:0, b:0, a:0.5}, fontColor: {r:16, g:219, b:2, a:1.0} } );
		sprite_Y.position.set( 0, axis_radius, 0 );
		scene.add( sprite_Y );
		
		var sprite_Z = makeTextSprite( 0, " Z ", 
		{ fontsize: 128, borderColor: {r:0, g:0, b:0, a:1.0}, borderThickness: 1, backgroundColor: {r:0, g:0, b:0, a:0.5}, fontColor: {r:50, g:119, b:255, a:1.0} } );
		sprite_Z.position.set( 0, 0, axis_radius );
		scene.add( sprite_Z );
	}

	//////////////////////////////////////////////////////////////////////////////////
	//		add an object and make it move					//
	//////////////////////////////////////////////////////////////////////////////////

	// var datGUI	= new dat.GUI()

	var containerEarth	= new THREE.Object3D()
	containerEarth.rotateZ(-23.4 * Math.PI/180)
	containerEarth.position.z	= 0
	scene.add(containerEarth)

	

	/*var moonMesh	= THREEx.Planets.createMoon()
	moonMesh.position.set(0.5,0.5,0.5)
	moonMesh.scale.multiplyScalar(1/5)
	moonMesh.receiveShadow	= true
	moonMesh.castShadow	= true
	containerEarth.add(moonMesh)
*/
	var earthMesh	= THREEx.Planets.createEarth()
	earthMesh.receiveShadow	= true
	earthMesh.castShadow	= true
	containerEarth.add(earthMesh)
	onRenderFcts.push(function(delta, now){
		earthMesh.rotation.y += 1/32 * delta * accel_time;		
	})

	if(show_earth_axis){
		var axis_earth = new THREE.AxisHelper( axis_earth_radius );
		axis_earth.position.set( 0, 0, 0 );
		earthMesh.add(axis_earth);
	}

	var geometry	= new THREE.SphereGeometry(0.5, 32, 32)
	var material	= THREEx.createAtmosphereMaterial()
	material.uniforms.glowColor.value.set(0x00b3ff)
	material.uniforms.coeficient.value	= 0.8
	material.uniforms.power.value		= 2.0
	var mesh	= new THREE.Mesh(geometry, material );
	mesh.scale.multiplyScalar(1.01);
	containerEarth.add( mesh );
	// new THREEx.addAtmosphereMaterial2DatGui(material, datGUI)

	var geometry	= new THREE.SphereGeometry(0.5, 32, 32)
	var material	= THREEx.createAtmosphereMaterial()
	material.side	= THREE.BackSide
	material.uniforms.glowColor.value.set(0x00b3ff)
	material.uniforms.coeficient.value	= 0.5
	material.uniforms.power.value		= 4.0
	var mesh	= new THREE.Mesh(geometry, material );
	mesh.scale.multiplyScalar(1.15);
	containerEarth.add( mesh );
	// new THREEx.addAtmosphereMaterial2DatGui(material, datGUI)

	var earthCloud	= THREEx.Planets.createEarthCloud()
	earthCloud.receiveShadow	= true
	earthCloud.castShadow	= true
	containerEarth.add(earthCloud)
	onRenderFcts.push(function(delta, now){
		earthCloud.rotation.y += 1/8 * delta * accel_time;		
	})

/*
	//////////////////////////////////////////////////////////////////////////////////
	//		Camera Controls							//
	//////////////////////////////////////////////////////////////////////////////////
	var mouse	= {x : 0, y : 0}
	document.addEventListener('mousemove', function(event){
		mouse.x	= (event.clientX / window.innerWidth ) - 0.5
		mouse.y	= (event.clientY / window.innerHeight) - 0.5
	}, false)
	onRenderFcts.push(function(delta, now){
		camera.position.x += (mouse.x*5 - camera.position.x) * (delta*3)
		camera.position.y += (mouse.y*5 - camera.position.y) * (delta*3)
		camera.lookAt( scene.position )
	})

*/
	//////////////////////////////////////////////////////////////////////////////////
	//		render the scene						//
	//////////////////////////////////////////////////////////////////////////////////
	onRenderFcts.push(function(){
		renderer.render( scene, camera );		
	})
	
	//////////////////////////////////////////////////////////////////////////////////
	//		loop runner							//
	//////////////////////////////////////////////////////////////////////////////////
	var lastTimeMsec= null
	requestAnimationFrame(function animate(nowMsec){
		// keep looping
		requestAnimationFrame( animate );
		// measure time
		lastTimeMsec	= lastTimeMsec || nowMsec-1000/60
		var deltaMsec	= Math.min(200, nowMsec - lastTimeMsec)
		lastTimeMsec	= nowMsec

		
		controls.update();
		// call each update function
		onRenderFcts.forEach(function(onRenderFct){
			onRenderFct(deltaMsec/1000, nowMsec/1000)
		})
	})


	
	//animate();

// FUNCTIONS 		


function animate() 
{
    	requestAnimationFrame( animate );
	render();		
	update();
}



function render() 
{
	renderer.render( scene, camera );
}

</script>

</body>
</html>
